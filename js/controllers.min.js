"use strict";var apControllers=angular.module("apControllers",[]);apControllers.controller("AppCtrl",["$scope","$location",function(t,o){t.navigateMe=function(t,n){switch(t){case"projects":o.url("/projects"+n);break;case"clients":o.url("/clients"+n);break;case"contacts":o.url("/contacts"+n)}},t.currentProject=""}]),apControllers.controller("HomeCtrl",["$scope",function(t){}]),apControllers.controller("ProjectsCtrl",["$scope","$location","$log","$mdDialog","dbAPI",function(t,o,n,e,c){t.projects={},t.getProjects=function(){c.getRecords("projects,clients",!1).then(function(o){t.projects=c.relations(o.data)},function(t){n.log(t)})},t.openProject=function(n){t.$parent.currentProject=n.name,o.url("/projects/"+n.id)},t.addProject=function(){e.show({controller:"projectDialogCtrl",templateUrl:"/templates/add-new-project.html"}).then(function(o){t.getProjects()},function(t){})},t.editProject=function(o){e.show({controller:"projectDialogCtrl",templateUrl:"/templates/add-new-project.html",locals:{projectObj:o},bindToController:!0}).then(function(){t.getProjects()},function(){})},t.deleteProject=function(o){e.show(e.confirm().title("Biztosan törlöd?").content("A művelet nem visszavonható").ok("Törlés").cancel("Mégse")).then(function(){c.deleteRecord("projects",o).then(function(o){t.getProjects()},function(t){n.log(t)})},function(){n.log("cancel")})},t.getProjects()}]),apControllers.controller("ProjectdetailsCtrl",["$scope","$location","$window","$mdDialog","$routeParams","$log","dbAPI",function(t,o,n,e,c,l,a){t.project={},t.jobs={},t.tasks={},t.clickedJob=-1,t.back=function(){n.history.back()},t.getJobs=function(){a.getRecords("jobs",!0,"parent_id,eq,"+c.id).then(function(o){t.project.name=t.$parent.currentProject,t.jobs=o.data.jobs},function(t){l.log(t)})},t.addJob=function(){e.show({controller:"jobDialogCtrl",templateUrl:"/templates/add-new-job.html",locals:{is_new:!0,parent_id:c.id},bindToController:!0}).then(function(o){t.getJobs()},function(t){})},t.editJob=function(o){e.show({controller:"jobDialogCtrl",templateUrl:"/templates/add-new-job.html",locals:{is_new:!1,jobObj:o},bindToController:!0}).then(function(o){t.getJobs()},function(t){})},t.getTasks=function(o){t.clickedJob=o,a.getRecords("tasks",!0,"parent_id,eq,"+o).then(function(o){t.tasks=o.data.tasks,l.log(t.tasks)},function(t){l.log(t)})},t.addTask=function(){e.show({controller:"taskDialogCtrl",templateUrl:"/templates/add-new-task.html",locals:{is_new:!0,parent_id:t.clickedJob},bindToController:!0}).then(function(o){t.getTasks(t.clickedJob)},function(t){})},t.getJobs()}]),apControllers.controller("ClientSettingsCtrl",["$scope","$location","$log","$mdDialog","dbAPI",function(t,o,n,e,c){t.clients={},t.contacts={},t.getClients=function(){c.getRecords("clients,contacts",!1).then(function(o){t.clients=c.relations(o.data)},function(t){n.log(t)})},t.addClient=function(){e.show({controller:"clientDialogCtrl",scope:t,preserveScope:!0,templateUrl:"/templates/add-new-client.html"}).then(function(){t.getClients()},function(){})},t.editClient=function(o){e.show({controller:"clientDialogCtrl",templateUrl:"/templates/add-new-client.html",locals:{clientObj:o},bindToController:!0}).then(function(){t.getClients()},function(){})},t.deleteClient=function(o){e.show(e.confirm().title("Biztosan törlöd?").content("A művelet nem visszavonható").ok("Törlés").cancel("Mégse")).then(function(){c.deleteRecord("clients",o).then(function(o){t.getClients()},function(t){n.log(t)})},function(){n.log("cancel")})},t.addContact=function(o){e.show({controller:"contactDialogCtrl",templateUrl:"/templates/add-new-contact.html",locals:{is_new:!0,client_id:o},bindToController:!0}).then(function(){t.getClients()},function(){})},t.openContacts=function(o){t.$parent.navigateMe("contacts","?filter="+o)},t.getClients()}]),apControllers.controller("ContactSettingsCtrl",["$scope","$location","$log","$mdDialog","dbAPI",function(t,o,n,e,c){t.contacts={},t.contactFilter=o.search().filter,t.getContacts=function(){c.getRecords("contacts,clients",!1).then(function(o){t.contacts=c.relations(o.data)},function(t){n.log(t)})},t.addContact=function(){e.show({controller:"contactDialogCtrl",templateUrl:"/templates/add-new-contact.html",locals:{is_new:!0},bindToController:!0}).then(function(){t.getContacts()},function(){})},t.editContact=function(o){e.show({controller:"contactDialogCtrl",templateUrl:"/templates/add-new-contact.html",locals:{is_new:!1,contactObj:o},bindToController:!0}).then(function(){t.getContacts()},function(){})},t.deleteContact=function(o){e.show(e.confirm().title("Biztosan törlöd?").content("A művelet nem visszavonható").ok("Törlés").cancel("Mégse")).then(function(){c.deleteRecord("contacts",o).then(function(o){t.getContacts()},function(t){n.log(t)})},function(){n.log("cancel")})},t.getContacts()}]),apControllers.controller("projectDialogCtrl",["$scope","$mdDialog","$log","dbAPI",function(t,o,n,e){t.projectData={},t.clients={};var c=this.locals;e.getRecords("clients",!0).then(function(o){t.clients=o.data.clients},function(t){n.log(t)}),c&&(angular.forEach(c.projectObj,function(o,n){t.projectData[n]=o}),delete t.projectData.clients,delete t.projectData.created,delete t.projectData.last_modified),t.saveProject=function(){c?e.updateRecord("projects",t.projectData.id,t.projectData).then(function(t){o.hide()},function(t){n.log(t)}):e.addRecord("projects",t.projectData).then(function(t){o.hide()},function(t){n.log(t)})},t.closeDialog=function(){o.cancel()}}]),apControllers.controller("clientDialogCtrl",["$scope","$mdDialog","$log","dbAPI",function(t,o,n,e){t.clientData={};var c=this.locals;c&&angular.forEach(c.clientObj,function(o,n){t.clientData[n]=o}),t.saveClient=function(){c?e.updateRecord("clients",t.clientData.id,t.clientData).then(function(t){o.hide()},function(t){n.log(t)}):e.addRecord("clients",t.clientData).then(function(t){o.hide()},function(t){n.log(t)})},t.closeDialog=function(){o.cancel()}}]),apControllers.controller("contactDialogCtrl",["$scope","$mdDialog","$log","dbAPI",function(t,o,n,e){t.contactData={},t.clients={};var c=this.locals;c.is_new?t.contactData.client_id=c.client_id:angular.forEach(c.contactObj,function(o,n){t.contactData[n]=o}),e.getRecords("clients",!0).then(function(o){t.clients=o.data.clients},function(t){n.log(t)}),t.saveContact=function(){c.is_new?e.addRecord("contacts",t.contactData).then(function(t){o.hide()},function(t){n.log(t)}):(delete t.contactData.clients,e.updateRecord("contacts",t.contactData.id,t.contactData).then(function(t){o.hide()},function(t){n.log(t)}),n.log(t.contactData))},t.closeDialog=function(){o.cancel()}}]),apControllers.controller("jobDialogCtrl",["$scope","$mdDialog","$log","dbAPI",function(t,o,n,e){t.jobData={};var c=this.locals;c.is_new||angular.forEach(c.jobObj,function(o,n){t.jobData[n]=o}),t.saveJob=function(){c.is_new?(t.jobData.parent_id=c.parent_id,e.addRecord("jobs",t.jobData).then(function(t){o.hide()},function(t){n.log(t)})):e.updateRecord("jobs",t.jobData.id,t.jobData).then(function(t){o.hide()},function(t){n.log(t)})},t.closeDialog=function(){o.cancel()}}]),apControllers.controller("taskDialogCtrl",["$scope","$mdDialog","$log","dbAPI",function(t,o,n,e){t.taskData={};var c=this.locals;c.is_new||angular.forEach(c.jobObj,function(o,n){t.taskData[n]=o}),t.saveTask=function(){c.is_new?(t.taskData.parent_id=c.parent_id,e.addRecord("tasks",t.taskData).then(function(t){o.hide()},function(t){n.log(t)})):e.updateRecord("tasks",t.taskData.id,t.taskData).then(function(t){o.hide()},function(t){n.log(t)})},t.closeDialog=function(){o.cancel()}}]);